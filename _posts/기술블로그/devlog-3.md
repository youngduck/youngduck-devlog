---
title: "버전업그레이드를 진행하며 얻은 작은 교훈"
excerpt: "Sentry를 도입하며 발생한 Next.js 와 Chromatic의 버전 호환성 문제"
coverImage: "/assets/blog/posts/devlog/devlog-3/cover.png"
date: "2025-06-17T00:20:00"
ogImage:
  url: "/assets/blog/posts/devlog/devlog-3/cover.png"
---

## 문제상황

안녕하세요! YD-TECH 개발자 김영덕입니다.
이번에는 사내 프로그램의 모니터링 시스템 구축을 위해 퇴근 후 개발 블로그에 Sentry를 도입해보면서 겪은 경험을 공유하고자 합니다.
&nbsp;

![Next 터보팩을 사용하면 15.3이상버전을 사용하라는 Sentry SDK의 경고](/assets/blog/posts/devlog/devlog-3/1.png)

&nbsp;
Sentry 설치 후 터미널에서 터보팩을 사용할 경우 SDK와의 호환성을 위해 Next.js 15.3.0 버전으로의 업그레이드가 필요하다는 안내를 받았습니다.
Sentry SDK에서 직접 버전 업그레이드를 권장하는 만큼, 15.0.4에서 15.3.0으로 업데이트를 진행했습니다. 이후에는 Sentry가 로컬에서 정상작동하는지만을 확인하고 경각심없이 잠을자러갔습니다. (~~퇴근후에 피곤했다는 핑계~~)

## 예상치 못한 문제 발생

![YD-28 티켓에서 발생한 크로마틱 빌드에러](/assets/blog/posts/devlog/devlog-3/2.png)

다음 날, 코드 변경이 없었음에도 불구하고 Chromatic 빌드에서 에러가 발생했습니다.
의아해서 커밋 이력을 살펴보니 이전 커밋까지는 정상적으로 빌드되었고, 이번 PR에서 발생한 문제임을 파악했습니다.

## 문제 분석

![스토리북에서 리액트 서버 컴포넌트 테스트시 모킹 API 무한요청 현상 발생](/assets/blog/posts/devlog/devlog-3/3.png)

처음에는 Sentry 설정이 Storybook 빌드에 영향을 준 것으로 추정하여 Storybook 설정에서 Sentry실행을 비활성화하는 방향으로 접근했으나, 문제는 해결되지 않았습니다.
&nbsp;
로컬 환경에서 Storybook을 실행해보니, 리액트 서버 컴포넌트(RSC)들이 모킹 API를 무한으로 요청하고 있는 것을 발견했습니다. 이로인해 크로마틱이 빌드가 되지 않던 것이었습니다.

## 원인 파악

![스토리북 무한 렌더링 이슈에 올라와있는 댓글](/assets/blog/posts/devlog/devlog-3/4.png)

무한 렌더링 이슈를 스토리북 깃허브에서 찾아보니 Next15, React19의 업데이트 과정에서 enableSiblingPrerendering 플래그 값을 true로 변경한 것이 주 원인일 것이라고 예상하는 [댓글](https://github.com/storybookjs/storybook/issues/30317)이 있었습니다.

해당 이슈에 대해 문제를 해결하여 오픈소스 기여자가 되면 좋겠지만, RSC에 대한 지식이 부족하기도 하고 목적은 Sentry 도입에 있었기에 버전 다운그레이드를 통해 문제를 해결하기로 결정했습니다.

## 해결 과정

1. Next.js를 다운그레이드하여 Storybook과 Chromatic 빌드 문제를 해결했으나, 이로 인해 Sentry가 배포환경에서 정상 작동하지 않는 새로운 문제가 발생했습니다.
2. 각기 다른 라이브러리의 버전에 따른 이슈였기 때문에 사용자로써는 해당 이슈를 제보를 통해 해결되기를 기다리거나 문제가되는 라이브러리들을 사용하지 않는다던가 하는 방법들밖에 없다고 생각하게 되었습니다. 혹시나 메이저한 도구가 아니라면 영영 해결되지 않을 수도 있다는 생각에 라이브러리를 조심스럽게 사용해야겠다는 생각을 한번 더 하게 되었습니다.
3. 3개의 기능은 모두 살리기 위한 시도 끝에 터보팩 사용을 중단하기로 결정했습니다. 로컬환경에서의 개발속도를 올려주는 터보팩은 현재 로컬 개발 환경에서만 베타 기능으로 제공하고 있고, 실서버에서는 여전히 웹팩을 사용하고 있어 개발-운영 환경의 일관성 측면도 올릴 수 있어 이런경험을 해보니 오히려 좋은 결정이라고 생각했습니다.

## 교훈

1. 새로운 버전이 항상 좋은 것은 아니다. (메이저 버전이 업데이트된 경우 초기에 불안정할 가능성이 굉장히 높다. 우리에게 꼭 필요한지를 잘판단해서 도입하자) 특히 실무 환경에서는 유저에게 크리티컬한 영향을 끼칠수 있으므로 더 신중한 판단이 필요하겠구나 생각했다.
2. 변경사항이 전체 시스템에 미치는 영향을 사전에 테스트하는 것이 중요하다! 이래서 자동화 도구들이나 테스트코드들이 있다는것을 다시금 깨달았다.

## 개선사항

교훈을 바탕으로 빌드테스트과정을 자동화 로직으로 만들어주기 위해서 Husky를 활용하여 push전에 Next빌드, Storybook 빌드, Chromatic빌드가 모두 성공했을때 push가 가능하도록 처리 해 주었습니다.

## 결론

이번 경험을 통해 새로운 기술 도입, 라이브러리 업데이트시에도 테스트의 중요성을 다시 한번 실감했습니다. 특히 프로젝트가 커져감에 따라, 자동화된 검증 프로세스 구축의 필요성을 체감할 수 있었습니다. 이번 업데이트를 통해 더 안정적인 개발 환경을 만들어가는 방법을 하나 얻어갈 수 있었던 것 같습니다.
